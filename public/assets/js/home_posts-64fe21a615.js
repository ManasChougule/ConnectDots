{let e=function(){$("#postForm").submit((async function(e){e.preventDefault();const s=document.getElementById("postInput").value.trim(),a=document.getElementById("imageInput").files[0];let o=null;if(a){const e=new FormData;e.append("image",a);const t=await fetch("/images/uploadImage",{method:"POST",body:e});if(!t.ok)return alert("Image upload failed"),!1;o=(await t.json()).file.filename}$.ajax({type:"post",url:"/posts/create",data:JSON.stringify({content:s,imageFileName:o}),contentType:"application/json",success:function(e){if(e.data){let s=t(e.data.post,e.data.user.name,e.data.user.id);$("#posts-list-container>ul").prepend(s),n($(".delete-post-button",s)),new PostComments(e.data.post._id),new ToggleLike($(".toggle-like-button",s)),document.getElementById("postForm").reset(),$("#selectedImageFileName").text(""),new Noty({theme:"relax",text:"Post published!",type:"success",layout:"topRight",timeout:1500}).show()}else alert("Post created but response is missing data.")},error:function(e){alert("Error while creating post: "+e.message)}})}))},t=function(e,t,n){return e.imageFileName&&(e.imageUrl=`/images/fetchImage/${e.imageFileName}`),$(`\n            <li id="post-${e._id}" class="post-wrapper list-group-item border rounded p-3 mb-3">\n\n            \x3c!-- ─── Post Content ─────────────────────────────────────────── --\x3e\n            <div class="post d-flex flex-column gap-1">\n\n                \x3c!-- Delete button (if owner/admin) --\x3e\n                <a href="/posts/destroy/${e._id}" class="delete-post-button align-self-end">\n                <i class="bi bi-trash-fill"></i>\n                </a>\n\n                ${e.imageUrl?`\n                <div class="imageDiv text-center my-3">\n                    <img src="${e.imageUrl}" alt="Post image" class="img-fluid rounded" style="max-width: 100%; max-height: 400px; width: auto; height: auto; object-fit: contain;">\n                </div>`:""}\n\n                <p class="mb-1 post-content">${e.content}</p>\n\n                <div class="d-flex flex-wrap gap-3 small text-muted">\n\n                <span style="font-weight: 600;">Author&nbsp:</span>\n                <a href="/users/profile/${n}" \n                    class="text-decoration-none  rounded-4" style="font-weight: 600;margin-left: -0.5rem;">\n                    <span><strong></strong>${t}</strong></span>\n                </a>\n\n                <a class="toggle-like-button like-button text-black-50"\n                    data-likes="0"\n                    href="/likes/toggle/?id=${e._id}&type=Post"\n                    data-liked="false">\n                    <i class="bi bi-heart-fill"></i>\n                    <span>0</span>\n                </a>\n                </div>\n            </div>\n\n            \x3c!-- ─── Comments ──────────────────────────────────────────────── --\x3e\n            <div class="post-comments mt-3">\n\n                <form id="post-${e._id}-comments-form" class="d-flex gap-2 mb-3" action="/comments/create"\n                    method="POST" onsubmit="return validateCommentForm()">\n                <input type="text" name="content"\n                        class="form-control" placeholder="Type a comment..." required>\n                <input type="hidden" name="post" value="${e._id}">\n                <div class="comment-footer d-flex flex-column">\n                    <button type="submit" class="btn btn-sm btn-primary">Add Comment</button>\n                    <span class="comment-hint small text-muted">Max 80 characters</span>\n                </div>\n                </form>\n\n                \x3c!-- Comments list will be dynamically appended here --\x3e\n                <ul id="post-comments-${e._id}" class="list-unstyled mb-0"></ul>\n            </div>\n            </li>\n        `)},n=function(e){$(e).each((function(){$(this).click((function(e){e.preventDefault();$.ajax({type:"get",url:$(this).prop("href"),success:function(e){$(`#post-${e.data.post_id}`).remove()},error:function(e){console.error("Error deleting post:",e)}})}))}))};$(document).ready((function(){e(),n($(".delete-post-button"))}))}